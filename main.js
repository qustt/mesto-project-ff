(()=>{"use strict";function t(t,e,n,o,c,r){var a=r.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__delete-button"),u=a.querySelector(".card__image"),l=a.querySelector(".card__title"),s=a.querySelector(".card__like-button");return u.src=e,u.alt=t,l.textContent=t,i.addEventListener("click",n),s.addEventListener("click",o),u.addEventListener("click",c),a}function e(t){t.target.classList.toggle("card__like-button_is-active")}function n(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function o(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function c(t){"Escape"===t.key&&o(document.querySelector(".popup_is-opened"))}var r={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"input__error"},a=function(t,e,n){var o=e.querySelector(".".concat(n.id,"-error"));n.classList.remove(t.inputErrorClass),o.classList.remove(t.errorClass),o.textContent=""};function i(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?(n.classList.remove(t.inactiveButtonClass),n.removeAttribute("disabled")):(n.classList.add(t.inactiveButtonClass),n.setAttribute("disabled","disabled"))}function u(t,e){t.querySelector(e.submitButtonSelector).classList.add(e.inactiveButtonClass),Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){a(e,t,n)}))}var l="https://nomoreparties.co/v1/wff-cohort-9",s="5993e96e-94d9-4e52-a8a8-15583d137850",d=function(t,e){return e.querySelector(".likes").textContent=t.length,e};function p(t,e){t?(e.textContent="Сохранение...",e.classList.add("popup__button_inactive"),e.setAttribute("disabled","disabled")):(e.textContent="Сохранить",e.classList.remove("popup__button_inactive"),e.removeAttribute("disabled"))}function _(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}var f,m=document.querySelector(".profile__edit-button"),v=document.querySelector(".profile__add-button"),y=document.querySelector(".button_save-profile"),h=document.querySelector(".button_save-avatar"),S=document.querySelector(".button_new-card"),q=document.querySelectorAll(".popup"),b=document.querySelector(".popup_type_edit"),g=document.querySelector(".popup_type_new-card"),L=document.querySelector(".popup_type_image"),E=document.querySelector(".popup_type_avatar"),C=b.querySelector(".popup__form"),k=document.querySelector("#card-template").content,x=document.querySelector(".places__list"),A=document.querySelector('.popup__form[name="new-place"]'),T=A.querySelector(".popup__input_type_card-name"),w=A.querySelector(".popup__input_type_url"),z=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),P=document.querySelector(".profile__image"),j=document.querySelector('.popup__form[name="edit-profile"]'),D=document.querySelector('.popup__form[name="new-avatar"]'),N=j.querySelector(".popup__input_type_name"),O=D.querySelector(".popup__input_type_avatar"),J=j.querySelector(".popup__input_type_description"),M="";function G(t){t.target.closest(".card").remove()}function H(t){var e=L.querySelector(".popup__image"),o=t.target.closest(".card__image");e.src=o.src,e.alt=o.alt,n(L)}function I(t){var e=t.target.closest(".card"),n=e.querySelector(".card__title").textContent,o=e.querySelector(".card__image").src;M.forEach((function(c){c.name===n&&c.link===o&&(t.target.classList.contains("card__like-button_is-active")?function(t,e){fetch("".concat(l,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:"".concat(s)}}).then((function(t){return _(t)})).then((function(t){d(t.likes,e)})).catch((function(t){console.log(t)}))}(c._id,e):function(t,e){fetch("".concat(l,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:"".concat(s)}}).then((function(t){return _(t)})).then((function(t){d(t.likes,e)})).catch((function(t){console.log(t)}))}(c._id,e))}))}Promise.all([fetch("".concat(l,"/cards"),{method:"GET",headers:{authorization:"".concat(s)}}).then((function(t){return _(t)})).catch((function(t){console.log(t)})),fetch("".concat(l,"/users/me"),{method:"GET",headers:{authorization:"".concat(s)}}).then((function(t){return _(t)})).catch((function(t){console.log(t)}))]).then((function(n){var o=n[0],c=n[1],r=c._id;o.forEach((function(n){var o=t(n.name,n.link,G,e,H,k),c=n.likes;!function(t,e,n){n!==t.owner._id&&e.querySelector(".card__delete-button").remove()}(n,o,r);var a=o.querySelector(".card__delete-button");a&&a.addEventListener("click",(function(){var t;t=n._id,fetch("".concat(l,"/cards/").concat(t),{method:"DELETE",headers:{authorization:"".concat(s)}}).then((function(t){return _(t)})).catch((function(t){console.log(t)}))}),!0),d(c,o);var i,u=o.querySelector(".card__like-button");c.forEach((function(t){t._id===r&&function(t){t.classList.toggle("card__like-button_is-active")}(u)})),u.addEventListener("click",I),i=o,x.append(i)})),z.textContent=c.name,B.textContent=c.about,P.style.backgroundImage="url(".concat(c.avatar,")"),M=o})).catch((function(t){console.log("Произошла ошибка: ".concat(t))})),m.addEventListener("click",(function(){u(C,r),n(b),N.value=z.textContent,J.value=B.textContent})),v.addEventListener("click",(function(){n(g)})),P.addEventListener("click",(function(){n(E)})),b.classList.add("popup_is-animated"),g.classList.add("popup_is-animated"),L.classList.add("popup_is-animated"),A.addEventListener("submit",(function(n){var c;p(!0,S),n.preventDefault(),c=t(T.value,w.value,G,e,H,k),x.prepend(c),function(t,e,n,o,c,r,a){fetch("".concat(l,"/cards"),{method:"POST",headers:{authorization:"".concat(s),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(t),link:"".concat(e)})}).then((function(t){return _(t)})).then((function(t){p(!1,a),n.value="",o.value="",c(r)})).catch((function(t){console.log(t)}))}(T.value,w.value,T,w,o,g,S),u(A,r)})),j.addEventListener("submit",(function(t){p(!0,y),t.preventDefault();var e=J.value,n=N.value;!function(t,e,n,o,c,r,a){fetch("".concat(l,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(s),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(o),about:"".concat(n)})}).then((function(t){return _(t)})).then((function(i){t.textContent=o,e.textContent=n,p(!1,a),c(r)})).catch((function(t){console.log(t)}))}(z,B,e,n,o,b,y)})),D.addEventListener("submit",(function(t){p(!0,h),t.preventDefault(),function(t,e,n,o,c){fetch("".concat(l,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(s),"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(t)})}).then((function(t){return _(t)})).then((function(){e.style.backgroundImage="url(".concat(t,")"),p(!1,c),n(o)})).catch((function(t){console.log(t)}))}(O.value,P,o,E,h),D.reset()})),f=r,Array.from(document.querySelectorAll(f.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);i(t,n,o),n.forEach((function(c){c.addEventListener("input",(function(){!function(t,e,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?a(t,e,n):function(t,e,n,o){var c=e.querySelector(".".concat(n.id,"-error"));n.classList.add(t.inputErrorClass),c.textContent=o,c.classList.add(t.errorClass)}(t,e,n,n.validationMessage)}(t,e,c),i(t,n,o)}))}))}(f,t)})),q.forEach((function(t){t.addEventListener("click",(function(e){(e.target===e.currentTarget||e.target.classList.contains("popup__close"))&&o(t)}))}))})();
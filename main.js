(()=>{"use strict";function t(t,r,a,u,i,l,s,d,p){var f=u.querySelector(".card").cloneNode(!0),_=f.querySelector(".card__delete-button"),m=f.querySelector(".card__like-button"),v=f.querySelector(".card__image"),y=f.querySelector(".card__title");return o(i.likes,f),v.src=r,v.alt=t,y.textContent=t,v.addEventListener("click",a),_.addEventListener("click",(function(){l(i._id).then((function(){f.remove()})).catch((function(t){console.log(t)}))}),!0),m.addEventListener("click",(function(){!function(t,e,c,r,a){t.classList.contains("card__like-button_is-active")?r(e).then((function(e){o(e.likes,c),n(t)})).catch((function(t){console.log(t)})):a(e).then((function(e){o(e.likes,c),n(t)})).catch((function(t){console.log(t)}))}(m,i._id,f,s,d)})),e(i,_,p),c(i.likes,p,m),f}var e=function(t,e,n){n!==t.owner._id&&e.remove()};function n(t){t.classList.toggle("card__like-button_is-active")}var o=function(t,e){e.querySelector(".likes").textContent=t.length},c=function(t,e,o){t.forEach((function(t){t._id===e&&n(o)}))};function r(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",u)}function a(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}function u(t){"Escape"===t.key&&a(document.querySelector(".popup_is-opened"))}var i=function(t,e,n){var o=e.querySelector(".".concat(n.id,"-error"));n.classList.remove(t.inputErrorClass),o.classList.remove(t.errorClass),o.textContent=""};function l(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?p(t,n):d(t,n)}function s(t,e){t.querySelector(e.submitButtonSelector).classList.add(e.inactiveButtonClass),Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){i(e,t,n)}))}function d(t,e){e.classList.add(t.inactiveButtonClass),e.setAttribute("disabled","disabled")}function p(t,e){e.classList.remove(t.inactiveButtonClass),e.removeAttribute("disabled")}var f="https://nomoreparties.co/v1/wff-cohort-9",_="5993e96e-94d9-4e52-a8a8-15583d137850",m=function(t){return fetch("".concat(f,"/cards/").concat(t),{method:"DELETE",headers:{authorization:"".concat(_)}}).then((function(t){return h(t)}))},v=function(t){return fetch("".concat(f,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:"".concat(_)}}).then((function(t){return h(t)}))},y=function(t){return fetch("".concat(f,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:"".concat(_)}}).then((function(t){return h(t)}))};function h(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}var S,q=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__add-button"),E=document.querySelector(".button_save-profile"),b=document.querySelector(".button_save-avatar"),L=document.querySelector(".button_new-card"),g=document.querySelectorAll(".popup"),k=document.querySelector(".popup_type_edit"),x=document.querySelector(".popup_type_new-card"),T=document.querySelector(".popup_type_image"),A=T.querySelector(".popup__image"),w=T.querySelector(".popup__caption"),z=document.querySelector(".popup_type_avatar"),B=k.querySelector(".popup__form"),P=document.querySelector("#card-template").content,j=document.querySelector(".places__list"),D=document.querySelector('.popup__form[name="new-place"]'),N=D.querySelector(".popup__input_type_card-name"),O=D.querySelector(".popup__input_type_url"),J=document.querySelector(".profile__title"),M=document.querySelector(".profile__description"),G=document.querySelector(".profile__image"),H=document.querySelector('.popup__form[name="edit-profile"]'),I=document.querySelector('.popup__form[name="new-avatar"]'),V=H.querySelector(".popup__input_type_name"),U=I.querySelector(".popup__input_type_avatar"),F=H.querySelector(".popup__input_type_description"),K={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"input__error"};function Q(t,e){t?(e.textContent="Сохранение...",d(K,e)):(e.textContent="Сохранить",p(K,e))}function R(t){var e=t.target.closest(".card"),n=e.querySelector(".card__image"),o=e.querySelector(".card__title");A.src=n.src,A.alt=n.alt,w.textContent=o.textContent,r(T)}Promise.all([fetch("".concat(f,"/cards"),{method:"GET",headers:{authorization:"".concat(_)}}).then((function(t){return h(t)})),fetch("".concat(f,"/users/me"),{method:"GET",headers:{authorization:"".concat(_)}}).then((function(t){return h(t)}))]).then((function(e){var n=e[0],o=e[1],c=o._id;n.forEach((function(e){var n;n=t(e.name,e.link,R,P,e,m,y,v,c),j.append(n)})),J.textContent=o.name,M.textContent=o.about,G.style.backgroundImage="url(".concat(o.avatar,")")})).catch((function(t){console.log("Произошла ошибка: ".concat(t))})),q.addEventListener("click",(function(){s(B,K),r(k),V.value=J.textContent,F.value=M.textContent})),C.addEventListener("click",(function(){r(x)})),G.addEventListener("click",(function(){r(z)})),k.classList.add("popup_is-animated"),x.classList.add("popup_is-animated"),T.classList.add("popup_is-animated"),D.addEventListener("submit",(function(e){var n,o;Q(!0,L),e.preventDefault(),(n=N.value,o=O.value,fetch("".concat(f,"/cards"),{method:"POST",headers:{authorization:"".concat(_),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(n),link:"".concat(o)})}).then((function(t){return h(t)}))).then((function(e){var n,o=e.owner._id,c=t(N.value,O.value,R,P,e,m,y,v,o);Q(!1,L),N.value="",O.value="",s(D,K),a(x),n=c,j.prepend(n)})).catch((function(t){console.log(t)}))})),H.addEventListener("submit",(function(t){Q(!0,E),t.preventDefault(),function(t,e){return fetch("".concat(f,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(_),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(e),about:"".concat(t)})}).then((function(t){return h(t)}))}(F.value,V.value).then((function(t){J.textContent=t.name,M.textContent=t.about,Q(!1,E),a(k)})).catch((function(t){console.log(t)}))})),I.addEventListener("submit",(function(t){var e;Q(!0,b),t.preventDefault(),(e=U.value,fetch("".concat(f,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(_),"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(e)})}).then((function(t){return h(t)}))).then((function(){G.style.backgroundImage="url(".concat(U.value,")"),Q(!1,b),s(I,K),a(z),I.reset()})).catch((function(t){console.log(t)}))})),S=K,Array.from(document.querySelectorAll(S.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);l(t,n,o),n.forEach((function(c){c.addEventListener("input",(function(){!function(t,e,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?i(t,e,n):function(t,e,n,o){var c=e.querySelector(".".concat(n.id,"-error"));n.classList.add(t.inputErrorClass),c.textContent=o,c.classList.add(t.errorClass)}(t,e,n,n.validationMessage)}(t,e,c),l(t,n,o)}))}))}(S,t)})),g.forEach((function(t){t.addEventListener("click",(function(e){(e.target===e.currentTarget||e.target.classList.contains("popup__close"))&&a(t)}))}))})();
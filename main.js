(()=>{"use strict";function t(t,e,n,o){var c=o.querySelector(".card").cloneNode(!0),r=(c.querySelector(".card__delete-button"),c.querySelector(".card__image")),a=c.querySelector(".card__title");return r.src=e,r.alt=t,a.textContent=t,r.addEventListener("click",n),c}var e=function(t,e){var n=e.querySelector(".card__like-button");return e.querySelector(".likes").textContent=t.length,n.classList.toggle("card__like-button_is-active"),e},n=function(t,e,n,o,c){var r=t.querySelector(".card__like-button");return r.addEventListener("click",(function(){!function(t,e,n,o,c,r){t.classList.contains("card__like-button_is-active")?o(e,n,r):c(e,n,r)}(r,e._id,t,n,o,c)})),t},o=function(t,e,n,o){var c=t.querySelector(".card__delete-button");return c&&c.addEventListener("click",(function(){e(n._id,t,o)}),!0),t};function c(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function r(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function a(t){"Escape"===t.key&&r(document.querySelector(".popup_is-opened"))}var u=function(t,e,n){var o=e.querySelector(".".concat(n.id,"-error"));n.classList.remove(t.inputErrorClass),o.classList.remove(t.errorClass),o.textContent=""};function i(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?(n.classList.remove(t.inactiveButtonClass),n.removeAttribute("disabled")):(n.classList.add(t.inactiveButtonClass),n.setAttribute("disabled","disabled"))}function l(t,e){t.querySelector(e.submitButtonSelector).classList.add(e.inactiveButtonClass),Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){u(e,t,n)}))}var s="https://nomoreparties.co/v1/wff-cohort-9",d="5993e96e-94d9-4e52-a8a8-15583d137850",p=function(t,e,n){fetch("".concat(s,"/cards/").concat(t),{method:"DELETE",headers:{authorization:"".concat(d)}}).then((function(t){return m(t)})).then((function(t){n(t,e)})).catch((function(t){console.log(t)}))},_=function(t,e,n){fetch("".concat(s,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:"".concat(d)}}).then((function(t){return m(t)})).then((function(t){n(t,e)})).catch((function(t){console.log(t)}))},f=function(t,e,n){fetch("".concat(s,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:"".concat(d)}}).then((function(t){return m(t)})).then((function(t){n(t,e)})).catch((function(t){console.log(t)}))};function m(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}var v,y=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__add-button"),S=document.querySelector(".button_save-profile"),q=document.querySelector(".button_save-avatar"),b=document.querySelector(".button_new-card"),g=document.querySelectorAll(".popup"),L=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_new-card"),E=document.querySelector(".popup_type_image"),k=E.querySelector(".popup__image"),x=E.querySelector(".popup__caption"),A=document.querySelector(".popup_type_avatar"),T=L.querySelector(".popup__form"),w=document.querySelector("#card-template").content,z=document.querySelector(".places__list"),B=document.querySelector('.popup__form[name="new-place"]'),P=B.querySelector(".popup__input_type_card-name"),j=B.querySelector(".popup__input_type_url"),D=document.querySelector(".profile__title"),N=document.querySelector(".profile__description"),O=document.querySelector(".profile__image"),J=document.querySelector('.popup__form[name="edit-profile"]'),M=document.querySelector('.popup__form[name="new-avatar"]'),G=J.querySelector(".popup__input_type_name"),H=M.querySelector(".popup__input_type_avatar"),I=J.querySelector(".popup__input_type_description"),V={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"input__error"};function U(t,e){t?(e.textContent="Сохранение...",e.classList.add("popup__button_inactive"),e.setAttribute("disabled","disabled")):(e.textContent="Сохранить",e.classList.remove("popup__button_inactive"),e.removeAttribute("disabled"))}function F(t){var e=t.target.closest(".card"),n=e.querySelector(".card__image"),o=e.querySelector(".card__title");k.src=n.src,k.alt=n.alt,x.textContent=o.textContent,c(E)}function K(t){D.textContent=t.name,N.textContent=t.about,U(!1,S),r(L)}function Q(t,e){var c;U(!1,b),P.value="",j.value="",l(B,V),r(C),console.log(e),n(e,t,f,_,W),o(e,p,t,R),c=e,z.prepend(c)}function R(t,e){!function(t){t.remove()}(e)}function W(t,n){e(t.likes,n)}function X(){console.log(H.value),O.style.backgroundImage="url(".concat(H.value,")"),U(!1,q),l(M,V),r(A),M.reset()}Promise.all([fetch("".concat(s,"/cards"),{method:"GET",headers:{authorization:"".concat(d)}}).then((function(t){return m(t)})),fetch("".concat(s,"/users/me"),{method:"GET",headers:{authorization:"".concat(d)}}).then((function(t){return m(t)}))]).then((function(e){var c=e[0],r=e[1],a=r._id;c.forEach((function(e){var c,r=t(e.name,e.link,F,w),u=e.likes;!function(t,e,n){n!==t.owner._id&&e.querySelector(".card__delete-button").remove()}(e,r,a),function(t,e){e.querySelector(".likes").textContent=t.length}(u,r),function(t,e,n){var o=e.querySelector(".card__like-button");t.forEach((function(t){t._id===n&&function(t){t.classList.toggle("card__like-button_is-active")}(o)}))}(u,r,a),o(r,p,e,R),n(r,e,f,_,W),c=r,z.append(c)})),D.textContent=r.name,N.textContent=r.about,O.style.backgroundImage="url(".concat(r.avatar,")")})).catch((function(t){console.log("Произошла ошибка: ".concat(t))})),y.addEventListener("click",(function(){l(T,V),c(L),G.value=D.textContent,I.value=N.textContent})),h.addEventListener("click",(function(){c(C)})),O.addEventListener("click",(function(){c(A)})),L.classList.add("popup_is-animated"),C.classList.add("popup_is-animated"),E.classList.add("popup_is-animated"),B.addEventListener("submit",(function(e){U(!0,b),e.preventDefault();var n=t(P.value,j.value,F,w);(function(t,e,n,o){fetch("".concat(s,"/cards"),{method:"POST",headers:{authorization:"".concat(d),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(t),link:"".concat(e)})}).then((function(t){return m(t)})).then((function(t){o(t,n)})).catch((function(t){console.log(t)}))})(P.value,j.value,n,Q),l(B,V)})),J.addEventListener("submit",(function(t){U(!0,S),t.preventDefault(),function(t,e,n){fetch("".concat(s,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(d),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(e),about:"".concat(t)})}).then((function(t){return m(t)})).then((function(t){n(t)})).catch((function(t){console.log(t)}))}(I.value,G.value,K)})),M.addEventListener("submit",(function(t){U(!0,q),t.preventDefault(),function(t,e){fetch("".concat(s,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(d),"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(t)})}).then((function(t){return m(t)})).then((function(){e()})).catch((function(t){console.log(t)}))}(H.value,X)})),v=V,Array.from(document.querySelectorAll(v.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);i(t,n,o),n.forEach((function(c){c.addEventListener("input",(function(){!function(t,e,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?u(t,e,n):function(t,e,n,o){var c=e.querySelector(".".concat(n.id,"-error"));n.classList.add(t.inputErrorClass),c.textContent=o,c.classList.add(t.errorClass)}(t,e,n,n.validationMessage)}(t,e,c),i(t,n,o)}))}))}(v,t)})),g.forEach((function(t){t.addEventListener("click",(function(e){(e.target===e.currentTarget||e.target.classList.contains("popup__close"))&&r(t)}))}))})();
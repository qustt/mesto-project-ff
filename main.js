(()=>{"use strict";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{De:()=>D,BU:()=>U,tz:()=>V,Ag:()=>I,Ju:()=>N,nE:()=>M,Pq:()=>J});var e,o={cohort:"https://nomoreparties.co/v1/wff-cohort-9/",profile:"https://nomoreparties.co/v1/wff-cohort-9/users/me",cards:"https://nomoreparties.co/v1/wff-cohort-9/cards",likes:"https://nomoreparties.co/v1/wff-cohort-9/cards/likes"},n={authorization:"5993e96e-94d9-4e52-a8a8-15583d137850",method:{get:"GET",post:"POST",patch:"PATCH",put:"PUT",delete:"DELETE"}},r="";Promise.all([void fetch("".concat(o.profile),{method:"".concat(n.method.get),headers:{authorization:"".concat(n.authorization)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка загрузки профиля ".concat(t.status))})).then((function(t){return function(t){I.textContent=t.name,U.textContent=t.about,V.style.backgroundImage="url(".concat(t.avatar,")"),r=t._id}(t)})).catch((function(t){console.log(t)})),void fetch("".concat(o.cards),{method:"".concat(n.method.get),headers:{authorization:"".concat(n.authorization)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка загрузки карт ".concat(t.status))})).then((function(t){return function(t){t.forEach((function(t){var e=t.likes,o=_(t.name,t.link,f,m,z);a(t,o),c(e,o),function(t){d.append(t)}(o)})),e=t}(t)})).catch((function(t){console.log(t)}))]);var c=function(t,e){return e.querySelector(".likes").textContent=t.length,e},a=function(t,e){return r!==t.owner._id?(e.querySelector(".card__delete-button").remove(),e):e},i=function(t){var r=t.querySelector(".card__title").textContent,c=t.querySelector(".card__image").src;e.forEach((function(t){t.name===r&&t.link===c&&fetch("".concat(o.cards,"/").concat(t._id),{method:"".concat(n.method.delete),headers:{authorization:"".concat(n.authorization)}})}))},u=function(t,r){var c=r.querySelector(".card__title").textContent;e.forEach((function(e){t.classList.contains("card__like-button_is-active")?e.name===c&&fetch("".concat(o.likes,"/").concat(e._id),{method:"".concat(n.method.put),headers:{authorization:"".concat(n.authorization)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))})).catch((function(t){console.log(t)})).then((function(t){s(t.likes,r)})):e.name===c&&fetch("".concat(o.likes,"/").concat(e._id),{method:"".concat(n.method.delete),headers:{authorization:"".concat(n.authorization)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))})).catch((function(t){console.log(t)})).then((function(t){s(t.likes,r)}))}))},s=function(t,e){e.querySelector(".likes").textContent=t.length};function l(t,e){e.textContent=t?"Сохранение...":"Сохранить"}var p=document.querySelector("#card-template").content,d=document.querySelector(".places__list");function _(t,e,o,n,r){var c=p.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__delete-button"),i=c.querySelector(".card__image"),u=c.querySelector(".card__title"),s=c.querySelector(".card__like-button");return i.src=e,i.alt=t,u.textContent=t,a.addEventListener("click",o),s.addEventListener("click",n),i.addEventListener("click",r),c}function f(t){var e=t.target.closest(".card");i(e),e.remove()}function m(t){t.target.classList.toggle("card__like-button_is-active"),u(t.target.closest(".card__like-button"),t.target.closest(".card"))}var h=function(t,e,o){var n=e.querySelector(".".concat(o.id,"-error"));o.classList.remove(t.inputErrorClass),n.classList.remove(t.errorClass),n.textContent=""};function v(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?(o.classList.remove(t.inactiveButtonClass),o.removeAttribute("disabled")):(o.classList.add(t.inactiveButtonClass),o.setAttribute("disabled","disabled"))}function y(t,e){t.querySelector(e.submitButtonSelector).classList.add(e.inactiveButtonClass),Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(o){h(e,t,o)}))}function S(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",b)}function q(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",b)}function b(t){"Escape"===t.key&&q(document.querySelector(".popup_is-opened"))}document.querySelectorAll(".popup").forEach((function(t){t.addEventListener("click",(function(e){(e.target===e.currentTarget||e.target.classList.contains("popup__close"))&&q(t)}))}));var g=document.querySelector('.popup__form[name="edit-profile"]'),C=g.querySelector(".popup__input_type_name"),k=g.querySelector(".popup__input_type_description");g.addEventListener("submit",(function(t){l(!0,J),t.preventDefault();var e=k.value,r=C.value,c=document.querySelector(".profile__title"),a=document.querySelector(".profile__description");c.textContent=r,a.textContent=e,fetch("".concat(o.profile),{method:"".concat(n.method.patch),headers:{authorization:"".concat(n.authorization),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(I.textContent),about:"".concat(U.textContent)})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))})).catch((function(t){console.log(t)})).finally((function(){l(!1,J)}))}));var E=document.querySelector('.popup__form[name="new-place"]'),L=E.querySelector(".popup__input_type_card-name"),j=E.querySelector(".popup__input_type_url");function z(t){var e=D.querySelector(".popup__image"),o=t.target.closest(".card__image");e.src=o.src,e.alt=o.alt,S(D)}E.addEventListener("submit",(function(t){l(!0,M),t.preventDefault();var e,r,c,a=L.value,i=j.value;e=_(a,i,f,m,z),d.prepend(e),r=a,c=i,fetch("".concat(o.cards),{method:"".concat(n.method.post),headers:{authorization:"".concat(n.authorization),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(r),link:"".concat(c)})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))})).catch((function(t){console.log(t)})).finally((function(){l(!1,M)})),L.value="",j.value="",y(E,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"input__error"})}));var x=document.querySelector('.popup__form[name="new-avatar"]');x.addEventListener("submit",(function(t){var e;l(!0,N),t.preventDefault(),e=x.querySelector(".popup__input_type_avatar").value,V.style.backgroundImage="url(".concat(e,")"),fetch("".concat(o.profile,"/avatar"),{method:"".concat(n.method.patch),headers:{authorization:"".concat(n.authorization),"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(e)})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))})).catch((function(t){console.log(t)})).finally((function(){l(!1,N)})),x.reset()}));var P,w=document.querySelector(".profile__edit-button"),B=document.querySelector(".profile__add-button"),A=document.querySelector(".popup_type_edit"),T=A.querySelector(".popup__form"),O=document.querySelector(".popup_type_new-card"),D=document.querySelector(".popup_type_image");w.addEventListener("click",(function(){y(T,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"input__error"}),S(A);var t=document.querySelector(".profile__title").textContent,e=document.querySelector(".profile__description").textContent;C.value=t,k.value=e})),B.addEventListener("click",(function(){S(O)})),A.classList.add("popup_is-animated"),O.classList.add("popup_is-animated"),D.classList.add("popup_is-animated"),P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"input__error"},Array.from(document.querySelectorAll(P.formSelector)).forEach((function(t){!function(t,e){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);v(t,o,n),o.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,o){o.validity.patternMismatch?o.setCustomValidity(o.dataset.errorMessage):o.setCustomValidity(""),o.validity.valid?h(t,e,o):function(t,e,o,n){var r=e.querySelector(".".concat(o.id,"-error"));o.classList.add(t.inputErrorClass),r.textContent=n,r.classList.add(t.errorClass)}(t,e,o,o.validationMessage)}(t,e,r),v(t,o,n)}))}))}(P,t)}));var J=document.querySelector(".button_save-profile"),N=document.querySelector(".button_save-avatar"),M=document.querySelector(".button_new-card"),I=document.querySelector(".profile__title"),U=document.querySelector(".profile__description"),V=document.querySelector(".profile__image"),G=document.querySelector(".popup_type_avatar");V.addEventListener("click",(function(){S(G)}))})();
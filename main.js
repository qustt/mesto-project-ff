(()=>{"use strict";function t(t,o,r,c,a,u,i,l,s,d,p,_){var f=c.querySelector(".card").cloneNode(!0),m=f.querySelector(".card__delete-button"),y=f.querySelector(".card__like-button"),v=f.querySelector(".card__image"),h=f.querySelector(".card__title");return f.querySelector(".likes").textContent=l.length,v.src=o,v.alt=t,h.textContent=t,v.addEventListener("click",r),m.addEventListener("click",(function(){u(a._id).then((function(t){i(t,f)})).catch((function(t){console.log(t)}))}),!0),y.addEventListener("click",(function(){!function(t,e,n,o,r,c){t.classList.contains("card__like-button_is-active")?o(e).then((function(t){return c(t,n)})).catch((function(t){console.log(t)})):r(e).then((function(t){return c(t,n)})).catch((function(t){console.log(t)}))}(y,a._id,f,s,d,p)})),e(a,f,_),n(l,f,_),f}var e=function(t,e,n){return n!==t.owner._id?(e.querySelector(".card__delete-button").remove(),e):e},n=function(t,e,n){var o=e.querySelector(".card__like-button");return t.forEach((function(t){t._id===n&&function(t){t.classList.toggle("card__like-button_is-active")}(o)})),e};function o(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function r(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function c(t){"Escape"===t.key&&r(document.querySelector(".popup_is-opened"))}var a=function(t,e,n){var o=e.querySelector(".".concat(n.id,"-error"));n.classList.remove(t.inputErrorClass),o.classList.remove(t.errorClass),o.textContent=""};function u(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?s(t,n):l(t,n)}function i(t,e){t.querySelector(e.submitButtonSelector).classList.add(e.inactiveButtonClass),Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){a(e,t,n)}))}function l(t,e){e.classList.add(t.inactiveButtonClass),e.setAttribute("disabled","disabled")}function s(t,e){e.classList.remove(t.inactiveButtonClass),e.removeAttribute("disabled")}var d="https://nomoreparties.co/v1/wff-cohort-9",p="5993e96e-94d9-4e52-a8a8-15583d137850",_=function(t){return fetch("".concat(d,"/cards/").concat(t),{method:"DELETE",headers:{authorization:"".concat(p)}}).then((function(t){return y(t)}))},f=function(t){return fetch("".concat(d,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:"".concat(p)}}).then((function(t){return y(t)}))},m=function(t){return fetch("".concat(d,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:"".concat(p)}}).then((function(t){return y(t)}))};function y(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}var v,h=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__add-button"),q=document.querySelector(".button_save-profile"),b=document.querySelector(".button_save-avatar"),g=document.querySelector(".button_new-card"),C=document.querySelectorAll(".popup"),E=document.querySelector(".popup_type_edit"),L=document.querySelector(".popup_type_new-card"),k=document.querySelector(".popup_type_image"),x=k.querySelector(".popup__image"),T=k.querySelector(".popup__caption"),A=document.querySelector(".popup_type_avatar"),w=E.querySelector(".popup__form"),z=document.querySelector("#card-template").content,B=document.querySelector(".places__list"),P=document.querySelector('.popup__form[name="new-place"]'),j=P.querySelector(".popup__input_type_card-name"),D=P.querySelector(".popup__input_type_url"),N=document.querySelector(".profile__title"),O=document.querySelector(".profile__description"),J=document.querySelector(".profile__image"),M=document.querySelector('.popup__form[name="edit-profile"]'),G=document.querySelector('.popup__form[name="new-avatar"]'),H=M.querySelector(".popup__input_type_name"),I=G.querySelector(".popup__input_type_avatar"),V=M.querySelector(".popup__input_type_description"),U={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"input__error"};function F(t,e){t?(e.textContent="Сохранение...",l(U,e)):(e.textContent="Сохранить",s(U,e))}function K(t){var e=t.target.closest(".card"),n=e.querySelector(".card__image"),r=e.querySelector(".card__title");x.src=n.src,x.alt=n.alt,T.textContent=r.textContent,o(k)}function Q(t,e){!function(t){t.remove()}(e)}function R(t,e){!function(t,e){var n=e.querySelector(".card__like-button");e.querySelector(".likes").textContent=t.length,n.classList.toggle("card__like-button_is-active")}(t.likes,e)}Promise.all([fetch("".concat(d,"/cards"),{method:"GET",headers:{authorization:"".concat(p)}}).then((function(t){return y(t)})),fetch("".concat(d,"/users/me"),{method:"GET",headers:{authorization:"".concat(p)}}).then((function(t){return y(t)}))]).then((function(e){var n=e[0],o=e[1],r=o._id;n.forEach((function(e){var n,o=e.likes;n=t(e.name,e.link,K,z,e,_,Q,o,m,f,R,r),B.append(n)})),N.textContent=o.name,O.textContent=o.about,J.style.backgroundImage="url(".concat(o.avatar,")")})).catch((function(t){console.log("Произошла ошибка: ".concat(t))})),h.addEventListener("click",(function(){i(w,U),o(E),H.value=N.textContent,V.value=O.textContent})),S.addEventListener("click",(function(){o(L)})),J.addEventListener("click",(function(){o(A)})),E.classList.add("popup_is-animated"),L.classList.add("popup_is-animated"),k.classList.add("popup_is-animated"),P.addEventListener("submit",(function(e){var n,o;F(!0,g),e.preventDefault(),(n=j.value,o=D.value,fetch("".concat(d,"/cards"),{method:"POST",headers:{authorization:"".concat(p),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(n),link:"".concat(o)})}).then((function(t){return y(t)}))).then((function(e){var n,o;console.log(e),n=t(j.value,D.value,K,z,e,_,Q,e.likes,m,f,R,e.owner._id),F(!1,g),j.value="",D.value="",i(P,U),r(L),o=n,B.prepend(o),i(P,U)})).catch((function(t){console.log(t)}))})),M.addEventListener("submit",(function(t){F(!0,q),t.preventDefault(),function(t,e){return fetch("".concat(d,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(p),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(e),about:"".concat(t)})}).then((function(t){return y(t)}))}(V.value,H.value).then((function(t){return function(t){N.textContent=t.name,O.textContent=t.about,F(!1,q),r(E)}(t)})).catch((function(t){console.log(t)}))})),G.addEventListener("submit",(function(t){var e;F(!0,b),t.preventDefault(),(e=I.value,fetch("".concat(d,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(p),"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(e)})}).then((function(t){return y(t)}))).then((function(){return J.style.backgroundImage="url(".concat(I.value,")"),F(!1,b),i(G,U),r(A),void G.reset()})).catch((function(t){console.log(t)}))})),v=U,Array.from(document.querySelectorAll(v.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);u(t,n,o),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?a(t,e,n):function(t,e,n,o){var r=e.querySelector(".".concat(n.id,"-error"));n.classList.add(t.inputErrorClass),r.textContent=o,r.classList.add(t.errorClass)}(t,e,n,n.validationMessage)}(t,e,r),u(t,n,o)}))}))}(v,t)})),C.forEach((function(t){t.addEventListener("click",(function(e){(e.target===e.currentTarget||e.target.classList.contains("popup__close"))&&r(t)}))}))})();
(()=>{"use strict";function t(t,e,n,o,c){var r=c.querySelector(".card").cloneNode(!0),a=(r.querySelector(".card__delete-button"),r.querySelector(".card__image")),i=r.querySelector(".card__title"),u=r.querySelector(".card__like-button");return a.src=e,a.alt=t,i.textContent=t,u.addEventListener("click",n),a.addEventListener("click",o),r}function e(t){t.target.classList.toggle("card__like-button_is-active")}function n(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function o(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function c(t){"Escape"===t.key&&o(document.querySelector(".popup_is-opened"))}var r={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"input__error"},a=function(t,e,n){var o=e.querySelector(".".concat(n.id,"-error"));n.classList.remove(t.inputErrorClass),o.classList.remove(t.errorClass),o.textContent=""},i=function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);u(t,n,o),n.forEach((function(c){c.addEventListener("input",(function(){!function(t,e,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?a(t,e,n):function(t,e,n,o){var c=e.querySelector(".".concat(n.id,"-error"));n.classList.add(t.inputErrorClass),c.textContent=o,c.classList.add(t.errorClass)}(t,e,n,n.validationMessage)}(t,e,c),u(t,n,o)}))}))}(t,e)}))};function u(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?(n.classList.remove(t.inactiveButtonClass),n.removeAttribute("disabled")):(n.classList.add(t.inactiveButtonClass),n.setAttribute("disabled","disabled"))}function l(t,e){t.querySelector(e.submitButtonSelector).classList.add(e.inactiveButtonClass),Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){a(e,t,n)}))}var s="https://nomoreparties.co/v1/wff-cohort-9",d="5993e96e-94d9-4e52-a8a8-15583d137850",p=function(t,e,n){fetch("".concat(s,"/cards/").concat(t),{method:"DELETE",headers:{authorization:"".concat(d)}}).then((function(t){return v(t)})).then((function(t){e(n)})).catch((function(t){console.log(t)}))},_=function(t,e,n){fetch("".concat(s,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:"".concat(d)}}).then((function(t){return v(t)})).then((function(t){n(t.likes,e)})).catch((function(t){console.log(t)}))},f=function(t,e,n){fetch("".concat(s,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:"".concat(d)}}).then((function(t){return v(t)})).then((function(t){n(t.likes,e)})).catch((function(t){console.log(t)}))};function m(t,e){t?(e.textContent="Сохранение...",e.classList.add("popup__button_inactive"),e.setAttribute("disabled","disabled")):(e.textContent="Сохранить",e.classList.remove("popup__button_inactive"),e.removeAttribute("disabled"))}function v(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}var y=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__add-button"),S=document.querySelector(".button_save-profile"),q=document.querySelector(".button_save-avatar"),b=document.querySelector(".button_new-card"),L=document.querySelectorAll(".popup"),g=document.querySelector(".popup_type_edit"),E=document.querySelector(".popup_type_new-card"),k=document.querySelector(".popup_type_image"),C=document.querySelector(".popup_type_avatar"),x=g.querySelector(".popup__form"),A=document.querySelector("#card-template").content,T=document.querySelector(".places__list"),w=document.querySelector('.popup__form[name="new-place"]'),z=w.querySelector(".popup__input_type_card-name"),B=w.querySelector(".popup__input_type_url"),P=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),D=document.querySelector(".profile__image"),N=document.querySelector('.popup__form[name="edit-profile"]'),O=document.querySelector('.popup__form[name="new-avatar"]'),J=N.querySelector(".popup__input_type_name"),M=O.querySelector(".popup__input_type_avatar"),G=N.querySelector(".popup__input_type_description"),H="";function I(t){T.prepend(t)}function V(t){t.remove()}var U=function(t,e){return e.querySelector(".likes").textContent=t.length,e};function F(t){var e=k.querySelector(".popup__image"),o=t.target.closest(".card__image");e.src=o.src,e.alt=o.alt,n(k)}function K(t){var e=t.target.closest(".card"),n=e.querySelector(".card__title").textContent,o=e.querySelector(".card__image").src;H.forEach((function(c){c.name===n&&c.link===o&&(t.target.classList.contains("card__like-button_is-active")?_(c._id,e,U):f(c._id,e,U))}))}function Q(t,e){var n=e.querySelector(".card__delete-button"),o=e.querySelector(".card__like-button");n.addEventListener("click",(function(){p(t,V,e)}),!0),o.addEventListener("click",(function(){o.classList.contains("card__like-button_is-active")?_(t,e,U):f(t,e,U)}))}Promise.all([fetch("".concat(s,"/cards"),{method:"GET",headers:{authorization:"".concat(d)}}).then((function(t){return v(t)})).catch((function(t){console.log(t)})),fetch("".concat(s,"/users/me"),{method:"GET",headers:{authorization:"".concat(d)}}).then((function(t){return v(t)})).catch((function(t){console.log(t)}))]).then((function(n){var o=n[0],c=n[1],r=c._id;o.forEach((function(n){var o=t(n.name,n.link,e,F,A),c=n.likes;!function(t,e,n){n!==t.owner._id&&e.querySelector(".card__delete-button").remove()}(n,o,r);var a=o.querySelector(".card__delete-button");a&&a.addEventListener("click",(function(){p(n._id,V,o)}),!0),U(c,o);var i,u=o.querySelector(".card__like-button");c.forEach((function(t){t._id===r&&function(t){t.classList.toggle("card__like-button_is-active")}(u)})),u.addEventListener("click",K),i=o,T.append(i)})),P.textContent=c.name,j.textContent=c.about,D.style.backgroundImage="url(".concat(c.avatar,")"),H=o})).catch((function(t){console.log("Произошла ошибка: ".concat(t))})),y.addEventListener("click",(function(){l(x,r),n(g),J.value=P.textContent,G.value=j.textContent})),h.addEventListener("click",(function(){n(E)})),D.addEventListener("click",(function(){n(C)})),g.classList.add("popup_is-animated"),E.classList.add("popup_is-animated"),k.classList.add("popup_is-animated"),w.addEventListener("submit",(function(n){m(!0,b),n.preventDefault();var c=t(z.value,B.value,e,F,A);(function(t,e,n,o,c,r,a,i,u,l,p,_){fetch("".concat(s,"/cards"),{method:"POST",headers:{authorization:"".concat(d),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(t),link:"".concat(e)})}).then((function(t){return v(t)})).then((function(t){m(!1,a),n.value="",o.value="",i(u),c(r),l(t._id,p),_(p)})).catch((function(t){console.log(t)}))})(z.value,B.value,z,B,o,E,b,i,r,Q,c,I),l(w,r)})),N.addEventListener("submit",(function(t){m(!0,S),t.preventDefault();var e=G.value,n=J.value;!function(t,e,n,o,c,r,a){fetch("".concat(s,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(d),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(o),about:"".concat(n)})}).then((function(t){return v(t)})).then((function(i){t.textContent=o,e.textContent=n,m(!1,a),c(r)})).catch((function(t){console.log(t)}))}(P,j,e,n,o,g,S)})),O.addEventListener("submit",(function(t){m(!0,q),t.preventDefault(),function(t,e,n,o,c,r,a){fetch("".concat(s,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(d),"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(t)})}).then((function(t){return v(t)})).then((function(){e.style.backgroundImage="url(".concat(t,")"),m(!1,c),r(a),n(o)})).catch((function(t){console.log(t)}))}(M.value,D,o,C,q,i,r),O.reset()})),i(r),L.forEach((function(t){t.addEventListener("click",(function(e){(e.target===e.currentTarget||e.target.classList.contains("popup__close"))&&o(t)}))}))})();